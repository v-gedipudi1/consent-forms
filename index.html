<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMS Informed Consent Form - HealMed Clinic</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to enhance Tailwind defaults and match original design intent */
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .form-content {
            padding: 40px;
        }

        .intro-text {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="date"],
        .form-group input[type="tel"],
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .gender-group, .yes-no-group {
            display: flex;
            gap: 20px;
        }

        .gender-option, .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-option input[type="radio"],
        .checkbox-option input[type="checkbox"] {
            transform: scale(1.2);
        }

        .question-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
            border-left: 4px solid #e74c3c;
        }

        .question-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .question {
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 12px;
            color: #2c3e50;
        }

        .implant-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        .checkbox-option {
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .consent-section {
            background: #e8f5e8;
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
            border-left: 4px solid #27ae60;
        }

        .consent-text {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .signature-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .submit-section {
            text-align: center;
            padding: 30px 0;
        }

        .submit-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .required {
            color: #e74c3c;
        }

        .message-box {
            display: none; /* Hidden by default */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f0fdf4; /* Light green for success */
            border: 1px solid #10b981; /* Green border */
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            text-align: center;
            font-size: 1.1em;
            color: #047857; /* Darker green text */
            max-width: 90%;
            border-left: 4px solid;
        }

        .message-box.error {
            background-color: #fef2f2; /* Light red for error */
            border-color: #ef4444; /* Red border */
            color: #dc2626; /* Darker red text */
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                margin: 0;
                border-radius: 10px;
            }

            .form-content {
                padding: 20px;
            }

            .implant-options {
                grid-template-columns: 1fr;
            }

            .signature-section {
                grid-template-columns: 1fr;
            }

            .gender-group, .yes-no-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>HealMed Clinic</h1>
            <p>TMS Informed Consent Form</p>
        </div>

        <div class="form-content">
            <div class="intro-text">
                <p><strong>Before you are able to receive TMS treatment, we need to make sure that it is safe for you to do so.</strong> To that end, we need information about the possible factors that could enhance your risk to experience unintentional adverse effects. Please fill out the questionnaire carefully and honestly. This form will subsequently be assessed by a physician.</p>
                <p style="margin-top: 15px;"><em>Please also sign at the bottom of each page</em></p>
            </div>

            <form id="tmsForm">
                <!-- Personal Information -->
                <div class="form-group mb-6">
                    <label for="fullName">First- and last name: <span class="required">*</span></label>
                    <input type="text" id="fullName" name="fullName" class="form-input" required>
                </div>

                <div class="form-group mb-6">
                    <label>Gender: <span class="required">*</span></label>
                    <div class="gender-group">
                        <div class="gender-option">
                            <input type="radio" id="male" name="gender" value="Male" required>
                            <label for="male">Male</label>
                        </div>
                        <div class="gender-option">
                            <input type="radio" id="female" name="gender" value="Female" required>
                            <label for="female">Female</label>
                        </div>
                        <div class="gender-option">
                            <input type="radio" id="other_gender" name="gender" value="Other" required>
                            <label for="other_gender">Other</label>
                        </div>
                    </div>
                </div>

                <div class="form-group mb-6">
                    <label for="dob">Date of Birth: <span class="required">*</span></label>
                    <input type="date" id="dob" name="dob" class="form-input" required>
                </div>

                <div class="form-group mb-6">
                    <label for="phone">Phone number: <span class="required">*</span></label>
                    <input type="tel" id="phone" name="phone" class="form-input" required>
                </div>

                <div class="form-group mb-6">
                    <label for="email">Email address: <span class="required">*</span></label>
                    <input type="email" id="email" name="email" class="form-input" required>
                </div>

                <!-- Screening Questionnaire -->
                <div class="question-section">
                    <h3>Screening Questionnaire</h3>

                    <div class="question">
                        <div class="question-text">1) Do you have epilepsy?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q1_yes" name="q1_epilepsy" value="Yes">
                                <label for="q1_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q1_no" name="q1_epilepsy" value="No">
                                <label for="q1_no">No</label>
                            </div>
                        </div>
                        <textarea name="q1_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">2) Have you ever had a convulsion or a seizure?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q2_yes" name="q2_seizure" value="Yes">
                                <label for="q2_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q2_no" name="q2_seizure" value="No">
                                <label for="q2_no">No</label>
                            </div>
                        </div>
                        <textarea name="q2_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">3) Does someone in your family have epilepsy?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q3_yes" name="q3_family_epilepsy" value="Yes">
                                <label for="q3_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q3_no" name="q3_family_epilepsy" value="No">
                                <label for="q3_no">No</label>
                            </div>
                        </div>
                        <textarea name="q3_details" class="form-input mt-3 hidden" placeholder="If yes, how are you related to this person?"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">4) Have you ever lost consciousness without any known reason?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q4_yes" name="q4_consciousness" value="Yes">
                                <label for="q4_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q4_no" name="q4_consciousness" value="No">
                                <label for="q4_no">No</label>
                            </div>
                        </div>
                        <textarea name="q4_details" class="form-input mt-3 hidden" placeholder="If yes, please describe when and how this occurred:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">5) Have you ever had a severe head trauma?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q5_yes" name="q5_head_trauma" value="Yes">
                                <label for="q5_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q5_no" name="q5_head_trauma" value="No">
                                <label for="q5_no">No</label>
                            </div>
                        </div>
                        <textarea name="q5_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">6) Have you ever had a stroke?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q6_yes" name="q6_stroke" value="Yes">
                                <label for="q6_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q6_no" name="q6_stroke" value="No">
                                <label for="q6_no">No</label>
                            </div>
                        </div>
                        <textarea name="q6_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">7) Have you ever undergone surgery to your head?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q7_yes" name="q7_head_surgery" value="Yes">
                                <label for="q7_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q7_no" name="q7_head_surgery" value="No">
                                <label for="q7_no">No</label>
                            </div>
                        </div>
                        <textarea name="q7_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">8) Do you have any of the following implants in your body:</div>
                        <div class="implant-options">
                            <div class="checkbox-option">
                                <input type="checkbox" id="implant_plates" name="implants" value="Metal plates/screws">
                                <label for="implant_plates">(metal) Plates and/or screws</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="implant_clips" name="implants" value="Vascular clips">
                                <label for="implant_clips">Vascular clips</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="implant_heart" name="implants" value="Artificial heart valve">
                                <label for="implant_heart">Artificial Heart valve</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="implant_splinters" name="implants" value="Metallic splinters/shrapnel">
                                <label for="implant_splinters">Metallic splinters/shrapnel/etc.</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="implant_pacemaker" name="implants" value="Pacemaker">
                                <label for="implant_pacemaker">Pacemaker</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="implant_pump" name="implants" value="Insulin pump">
                                <label for="implant_pump">Insulin pump</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="implant_hearing" name="implants" value="Internal hearing aid">
                                <label for="implant_hearing">Internal hearing aid (cochlear implant)</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="implant_other" name="implants" value="Other implant">
                                <label for="implant_other">Any other implant not mentioned above</label>
                            </div>
                        </div>
                        <textarea name="q8_details" class="form-input mt-3 hidden" placeholder="If you answered 'yes' to any of the questions above, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">9) Do you have any deviations of the spinal cord, bone marrow, or the ventricular system (spaces in the brain filled with liquid)?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q9_yes" name="q9_deviations" value="Yes">
                                <label for="q9_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q9_no" name="q9_deviations" value="No">
                                <label for="q9_no">No</label>
                            </div>
                        </div>
                        <textarea name="q9_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">10) Do you have any hearing disabilities or ringing in your ears?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q10_yes" name="q10_hearing" value="Yes">
                                <label for="q10_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q10_no" name="q10_hearing" value="No">
                                <label for="q10_no">No</label>
                            </div>
                        </div>
                        <textarea name="q10_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">11) Have you ever (at present or in the past) suffered from a brain-related, neurological illness?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q11_yes" name="q11_neurological" value="Yes">
                                <label for="q11_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q11_no" name="q11_neurological" value="No">
                                <label for="q11_no">No</label>
                            </div>
                        </div>
                        <textarea name="q11_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">12) Do you suffer from frequent severe headaches?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q12_yes" name="q12_headaches" value="Yes">
                                <label for="q12_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q12_no" name="q12_headaches" value="No">
                                <label for="q12_no">No</label>
                            </div>
                        </div>
                        <textarea name="q12_details" class="form-input mt-3 hidden" placeholder="If yes, please describe how often, and on which occasions:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">13) Are you currently under any form of medical treatment?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q13_yes" name="q13_treatment" value="Yes">
                                <label for="q13_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q13_no" name="q13_treatment" value="No">
                                <label for="q13_no">No</label>
                            </div>
                        </div>
                        <textarea name="q13_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">14) Are you currently taking antibiotics (a medication that helps alleviate bacterial infections)?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q14_yes" name="q14_antibiotics" value="Yes">
                                <label for="q14_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q14_no" name="q14_antibiotics" value="No">
                                <label for="q14_no">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="question">
                        <div class="question-text">15) Do you ever take antihistamines (anti-allergy medication)?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q15_yes" name="q15_antihistamines" value="Yes">
                                <label for="q15_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q15_no" name="q15_antihistamines" value="No">
                                <label for="q15_no">No</label>
                            </div>
                        </div>
                        <textarea name="q15_details" class="form-input mt-3 hidden" placeholder="If yes, how often and when was the last time you took them?"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">16) Are you taking any other medications not mentioned above?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q16_yes" name="q16_other_meds" value="Yes">
                                <label for="q16_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q16_no" name="q16_other_meds" value="No">
                                <label for="q16_no">No</label>
                            </div>
                        </div>
                        <textarea name="q16_details" class="form-input mt-3 hidden" placeholder="If yes, please list:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">17) Do you have a chronic illness/disorder?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q17_yes" name="q17_chronic" value="Yes">
                                <label for="q17_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q17_no" name="q17_chronic" value="No">
                                <label for="q17_no">No</label>
                            </div>
                        </div>
                        <textarea name="q17_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">18) Have you ever (at present or in the past) had a psychiatric-based illness/disorder?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q18_yes" name="q18_psychiatric" value="Yes">
                                <label for="q18_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q18_no" name="q18_psychiatric" value="No">
                                <label for="q18_no">No</label>
                            </div>
                        </div>
                        <textarea name="q18_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">19) Does someone in your family have a psychiatric-based illness/disorder?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q19_yes" name="q19_family_psychiatric" value="Yes">
                                <label for="q19_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q19_no" name="q19_family_psychiatric" value="No">
                                <label for="q19_no">No</label>
                            </div>
                        </div>
                        <textarea name="q19_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                        <textarea name="q19_relation" class="form-input mt-3 hidden" placeholder="How are you related to this person?"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">20) Have you used any recreational drugs during the past year (such as marijuana, ecstasy, cocaine, etc.)?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q20_yes" name="q20_drugs" value="Yes">
                                <label for="q20_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q20_no" name="q20_drugs" value="No">
                                <label for="q20_no">No</label>
                            </div>
                        </div>
                        <textarea name="q20_details" class="form-input mt-3 hidden" placeholder="If yes, please specify which drugs did you use, and when was the last time that you used them?"></textarea>
                    </div>

                    <!-- Question 21 is intentionally skipped as per the provided physical copy's numbering -->

                    <div class="question">
                        <div class="question-text">22) Have you ever suffered from substance dependence or abuse?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q22_yes" name="q22_substance_abuse" value="Yes">
                                <label for="q22_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q22_no" name="q22_substance_abuse" value="No">
                                <label for="q22_no">No</label>
                            </div>
                        </div>
                        <textarea name="q22_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">23) Do you averagely consume more than 3 alcoholic units a day?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q23_yes" name="q23_alcohol" value="Yes">
                                <label for="q23_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q23_no" name="q23_alcohol" value="No">
                                <label for="q23_no">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="question">
                        <div class="question-text">24) Do you have sleeping problems?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q24_yes" name="q24_sleep" value="Yes">
                                <label for="q24_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q24_no" name="q24_sleep" value="No">
                                <label for="q24_no">No</label>
                            </div>
                        </div>
                        <textarea name="q24_details" class="form-input mt-3 hidden" placeholder="If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">25) Are you pregnant, or is there a chance that you might be?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q25_yes" name="q25_pregnant" value="Yes">
                                <label for="q25_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q25_no" name="q25_pregnant" value="No">
                                <label for="q25_no">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="question">
                        <div class="question-text">26) Have you ever undergone an MRI for clinical purposes?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q26_yes" name="q26_mri" value="Yes">
                                <label for="q26_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q26_no" name="q26_mri" value="No">
                                <label for="q26_no">No</label>
                            </div>
                        </div>
                        <textarea name="q26_details" class="form-input mt-3 hidden" placeholder="If yes, did any problems occur during scanning? If yes, please specify:"></textarea>
                    </div>

                    <div class="question">
                        <div class="question-text">27) Have you ever undergone TMS?</div>
                        <div class="yes-no-group">
                            <div class="radio-option">
                                <input type="radio" id="q27_tms_yes" name="q27_tms" value="Yes">
                                <label for="q27_tms_yes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="q27_tms_no" name="q27_tms" value="No">
                                <label for="q27_tms_no">No</label>
                            </div>
                        </div>
                        <textarea name="q27_details" class="form-input mt-3 hidden" placeholder="If yes, have you ever had an adverse reaction to TMS? If yes, please specify:"></textarea>
                    </div>
                </div>

                <!-- Consent Section -->
                <div class="consent-section">
                    <h3>Informed Consent for TMS Treatment</h3>
                    <p class="consent-text">I answered all questions truthfully and to the best of my knowledge and belief. If deemed medically appropriate by my physician, I consent to undergo transcranial magnetic stimulation under the care and direction of my physician.</p>
                </div>

                <!-- Signature Section -->
                <div class="signature-section">
                    <div class="form-group">
                        <label for="patientSignature">Signature: <span class="required">*</span></label>
                        <input type="text" id="patientSignature" name="patientSignature" class="form-input" placeholder="Type your full name as signature" required>
                    </div>
                    <div class="form-group">
                        <label for="signatureDate">Date: <span class="required">*</span></label>
                        <input type="date" id="signatureDate" name="signatureDate" class="form-input" required>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="submit-section">
                    <button type="submit" class="submit-btn">Submit Consent Form</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Message Box for Success/Error -->
    <div id="messageBox" class="message-box"></div>

    <!-- Firebase SDK - IMPORTANT: Your actual config -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        // YOUR SPECIFIC FIREBASE CONFIGURATION (Copied from your previous messages)
        const firebaseConfig = {
          apiKey: "AIzaSyBkDIpwGI8mU-xcDIuKVurEiMCJE2IksDI",
          authDomain: "consent-form-5a399.firebaseapp.com",
          projectId: "consent-form-5a399",
          storageBucket: "consent-form-5a399.firebasestorage.app",
          messagingSenderId: "577373619871",
          appId: "1:577373619871:web:181f98d0a4e21a58e284aa",
          measurementId: "G-3LZ6RCM4VH"
        };


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const tmsForm = document.getElementById('tmsForm');
        const messageBox = document.getElementById('messageBox');

        function showMessage(message, isError = false) {
            messageBox.textContent = message;
            messageBox.className = 'message-box'; // Reset classes
            if (isError) {
                messageBox.classList.add('error');
            } else {
                messageBox.classList.add('success'); // Add success class if not error
            }
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 5000); // Hide after 5 seconds
        }

        tmsForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevent default form submission (e.g., mailto or page reload)

            const formData = new FormData(tmsForm);
            const data = {};
            for (let [key, value] of formData.entries()) {
                // For checkboxes, group them into an array
                if (key === 'implants') {
                    if (!data[key]) {
                        data[key] = [];
                    }
                    data[key].push(value);
                } else {
                    data[key] = value;
                }
            }

            // Capture the submission timestamp
            data.submissionTimestamp = new Date().toISOString();

            console.log("Attempting to save data to Firestore:", data); // Log data being sent

            try {
                // Add a new document to the "consentForms" collection
                await addDoc(collection(db, "consentForms"), data);
                showMessage("Form submitted successfully! Your answers have been recorded.", false);
                tmsForm.reset(); // Clear the form after successful submission
                // Re-hide textareas after reset
                document.querySelectorAll('textarea.form-input').forEach(textarea => {
                    textarea.classList.add('hidden');
                    textarea.removeAttribute('required');
                    textarea.value = '';
                });

                console.log("Data saved successfully!");

            } catch (e) {
                console.error("Error adding document to Firestore: ", e); // Log detailed error
                let errorMessage = "Error submitting form. Please try again later.";
                if (e.code) { // Firebase errors usually have a 'code' property
                    errorMessage = `Error: ${e.code.replace('auth/', '').replace(/-/g, ' ')}. Please check console for details.`;
                }
                showMessage(errorMessage, true);
            }
        });

        // Function to toggle the visibility of a textarea(s) based on radio button selection
        function setupRadioToggle(radioGroupName, textareaName, isMultipleTextareas = false) {
            const radios = document.querySelectorAll(`input[name="${radioGroupName}"]`);
            let textareas = [];

            if (isMultipleTextareas) {
                textareas = Array.from(document.querySelectorAll(`textarea[name^="${textareaName}"]`));
            } else {
                const singleTextarea = document.querySelector(`textarea[name="${textareaName}"]`);
                if (singleTextarea) {
                    textareas = [singleTextarea];
                }
            }

            if (!radios.length || textareas.length === 0) return;

            radios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'Yes') {
                        textareas.forEach(textarea => {
                            textarea.classList.remove('hidden');
                            textarea.setAttribute('required', 'true');
                        });
                    } else {
                        textareas.forEach(textarea => {
                            textarea.classList.add('hidden');
                            textarea.removeAttribute('required');
                            textarea.value = '';
                        });
                    }
                });
            });

            // Initial check on page load to ensure textareas are hidden if no "Yes" is selected
            const checkedYes = document.querySelector(`input[name="${radioGroupName}"][value="Yes"]:checked`);
            if (!checkedYes) {
                textareas.forEach(textarea => {
                    textarea.classList.add('hidden');
                    textarea.removeAttribute('required');
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Setup toggles for each question with a textarea
            setupRadioToggle('q1_epilepsy', 'q1_details');
            setupRadioToggle('q2_seizure', 'q2_details');
            setupRadioToggle('q3_family_epilepsy', 'q3_details');
            setupRadioToggle('q4_consciousness', 'q4_details');
            setupRadioToggle('q5_head_trauma', 'q5_details');
            setupRadioToggle('q6_stroke', 'q6_details');
            setupRadioToggle('q7_head_surgery', 'q7_details');

            // For implants (q8), we listen to all checkboxes
            const implantCheckboxes = document.querySelectorAll('input[name="implants"]');
            const implantDetailsTextarea = document.querySelector('textarea[name="q8_details"]');
            if (implantCheckboxes.length && implantDetailsTextarea) {
                implantCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const anyChecked = Array.from(implantCheckboxes).some(cb => cb.checked);
                        if (anyChecked) {
                            implantDetailsTextarea.classList.remove('hidden');
                            implantDetailsTextarea.setAttribute('required', 'true');
                        } else {
                            implantDetailsTextarea.classList.add('hidden');
                            implantDetailsTextarea.removeAttribute('required');
                            implantDetailsTextarea.value = '';
                        }
                    });
                });
                // Initial check for implants to ensure textarea is hidden
                const anyImplantCheckedInitially = Array.from(implantCheckboxes).some(cb => cb.checked);
                if (!anyImplantCheckedInitially) {
                    implantDetailsTextarea.classList.add('hidden');
                    implantDetailsTextarea.removeAttribute('required');
                }
            }

            setupRadioToggle('q9_deviations', 'q9_details');
            setupRadioToggle('q10_hearing', 'q10_details');
            setupRadioToggle('q11_neurological', 'q11_details');
            setupRadioToggle('q12_headaches', 'q12_details');
            setupRadioToggle('q13_treatment', 'q13_details');
            setupRadioToggle('q15_antihistamines', 'q15_details');
            setupRadioToggle('q16_other_meds', 'q16_details');
            setupRadioToggle('q17_chronic', 'q17_details');
            setupRadioToggle('q18_psychiatric', 'q18_details');

            setupRadioToggle('q19_family_psychiatric', 'q19_', true);

            setupRadioToggle('q20_drugs', 'q20_details');
            setupRadioToggle('q22_substance_abuse', 'q22_details');
            setupRadioToggle('q24_sleep', 'q24_details');
            setupRadioToggle('q26_mri', 'q26_details');
            setupRadioToggle('q27_tms', 'q27_details');
        });
    </script>
</body>
</html>
